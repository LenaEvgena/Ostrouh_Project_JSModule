<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AJAX — прогресс загрузки объёмного файла</title>
</head>
<body>
  <input type=button onclick='TestLoadData()' value='загрузить большой JSON'>
  <br/><br/>
  <div id='IProgress' style='border: solid red 1px; width: 200px'>
    <div id='IProgressPerc' style='background-color: red; height: 20px; width: 0%'></div>
  </div>


  <script src='http://code.jquery.com/jquery-latest.js'></script>

  <script>

    let image = 'startbg';

    function TestLoadData() {
      $.ajax(`assets/img/backgrounds/${image}.png`,
        {
          type: 'GET',
          contentType: 'image/png',
          cache: false,
          success: Success,
          complete: Complete,
          error: ErrorHandler,
          xhrFields: {onprogress: Progress}
        }
        /*Опция xhrFields позволяет указать различные опции,
        присущие именно объекту jQuery AJAX, в данном случае
        мы задаём опцию onprogress — это, по сути, обработчик
        события progress, которое возникает каждый раз
        при получении по сети очередной порции данных.*/
      );

    }

    /*Обработчик события progress получает объект события,
    в котором можно проверить опцию lengthComputable — она показывает,
    известна ли вообще длина ответа; и можно прочитать свойства
    loaded и total, которые содержат соответственно количество
    уже полученных по сети байт и общее количество байт ответа.
    Соответственным образом и устанавливается ширина линеечки.*/
    function Progress(EO) {
      console.log(EO);
      if (EO.lengthComputable) {
        var Perc = Math.round(EO.loaded / EO.total * 100);
        document.getElementById('IProgressPerc').style.width = Perc + "%";
      }
    }

    function Success(data) {
      console.log('загруженные через AJAX данные:');
      // console.log(data);
    }

    function Complete() {
      document.getElementById('IProgress').style.display = "none";
    }

    function ErrorHandler(jqXHR, StatusStr, ErrorStr) {
      alert(StatusStr + ' ' + ErrorStr);
    }





    // /*При загрузке через AJAX крупных файлов любого типа, имеет смысл
    // отображать прогресс загрузки. Он может выглядеть как угодно — линеечка,
    // градусник, просто <span> с текстом "25%".
    // Посмотрим, как это можно сделать.*/

    // function TestLoadData() {
    //   $.ajax("http://fe.it-academy.by/Examples/net_city/cities.json",
    //     {
    //       type: 'GET',
    //       dataType: 'json',
    //       /*Отключаем кэширование — нам же хочется видеть процесс
    //       загрузки данных, и мы не хотим, чтобы данные брались из
    //       кэша, т.к. это было бы слишком быстро.*/
    //       cache: false,
    //       success: Success,
    //       complete: Complete,
    //       error: ErrorHandler,
    //       xhrFields: {onprogress: Progress}
    //     }
    //     /*Опция xhrFields позволяет указать различные опции,
    //     присущие именно объекту jQuery AJAX, в данном случае
    //     мы задаём опцию onprogress — это, по сути, обработчик
    //     события progress, которое возникает каждый раз
    //     при получении по сети очередной порции данных.*/
    //   );

    // }

    // /*Обработчик события progress получает объект события,
    // в котором можно проверить опцию lengthComputable — она показывает,
    //  известна ли вообще длина ответа; и можно прочитать свойства
    //  loaded и total, которые содержат соответственно количество
    //  уже полученных по сети байт и общее количество байт ответа.
    //  Соответственным образом и устанавливается ширина линеечки.*/
    // function Progress(EO) {
    //   console.log(EO);
    //   if (EO.lengthComputable) {
    //     var Perc = Math.round(EO.loaded / EO.total * 100);
    //     document.getElementById('IProgressPerc').style.width = Perc + "%";
    //   }
    // }

    // function Success(data) {
    //   console.log('загруженные через AJAX данные:');
    //   console.log(data);
    // }

    // function Complete() {
    //   document.getElementById('IProgress').style.display = "none";
    // }

    // function ErrorHandler(jqXHR, StatusStr, ErrorStr) {
    //   alert(StatusStr + ' ' + ErrorStr);
    // }

    // /*Анализируя объём загруженных данных и прошедшее с начала
    // загрузки время, можно оценить скорость загрузки данных;
    // её можно отобразить (для информации) или использовать для
    // предсказания времени окончания загрузки.*/

  </script>
</body>
</html>
